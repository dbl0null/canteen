
#
# CircleCI - canteen/gust
#

machine:
  timezone: America/Los_Angeles
  python:
    version: 2.7.11

dependencies:
  pre:
    - mkdir -p bin/ && ln -s `which pip` bin/pip && ln -s `which python` bin/python
    - virtualenv --version || sudo pip install --upgrade virtualenv
  override:
    - make dependencies BUILDBOT=1 DEPS=1

test:
  pre:
    - make package BUILDBOT=1 DEPS=0 TESTS=0
  override:
    - make test BUILDBOT=1 DEPS=0 TESTS=1
  post:
    - cd .develop && tar -czvf ../reports.tar.gz tests coverage
    - mkdir -p $CIRCLE_TEST_REPORTS/django/ && find . -type f -regex ".develop/tests/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/django/ \;
    - mkdir -p $CIRCLE_TEST_REPORTS/django/coverage/ && cp -frv .develop/coverage/* $CIRCLE_TEST_REPORTS/django/coverage/;

general:
  artifacts:
    - "dist/*.egg"
    - "dist/*.tar.gz"
    - "reports.tar.gz"

